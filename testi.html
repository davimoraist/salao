 

<!DOCTYPE html>
 <html lang="pt-BR">
 <head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Salão do João</title>
   <style>
     body { font-family: Arial, sans-serif; background-color: #f5f5f5; margin:0; padding:0; }
     header { background-color: #ff7f50; color:white; text-align:center; padding:20px 0; }
     h2 { color: #333; }
     .container { max-width:600px; margin:20px auto; background-color:white; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
     label { display:block; margin-top:10px; }
     input, select { width:100%; padding:8px; margin-top:5px; border-radius:5px; border:1px solid #ccc; box-sizing:border-box;}
     button { margin-top:15px; padding:10px 20px; background-color:#ff7f50; color:white; border:none; border-radius:5px; cursor:pointer;}
     button:hover { background-color:#e76b3c;}
     iframe { width:100%; height:300px; border:0; margin-top:10px; border-radius:10px; }
     .error { color:red; margin-top:10px; }
   </style>
 </head>
 <body>

 <header>
   <h1>Salão do João</h1>
   <p>Beleza e cuidado em um só lugar!</p>
 </header>

 <div class="container">
   <h2>Agendamento</h2>
   <form id="agendamentoForm">
     <label for="nome">Nome:</label>
     <input type="text" id="nome" required>

     <label for="telefone">Telefone ou WhatsApp (formato: (61) 9575-6256):</label>
     <input type="text" id="telefone" placeholder="(61) 9575-6256" required>

     <label for="servico">Serviço:</label>
     <select id="servico" required>
       <option value="">Selecione</option>
       <option value="Corte de cabelo">Corte de cabelo</option>
       <option value="Barba">Barba</option>
       <option value="Cabelo + Barba">Cabelo + Barba</option>
     </select>

     <label for="alergia">Alergia a algum produto? (opcional):</label>
     <input type="text" id="alergia" placeholder="Ex: tintura, creme X">

     <label for="data">Data e hora:</label>
     <input type="datetime-local" id="data" required>

     <button type="submit">Enviar Agendamento</button>
     <p id="mensagem" class="error"></p>
   </form>
 </div>

 <div class="container">
   <h2>Contato</h2>
   <p>Telefone / WhatsApp: <strong>(61) 9575-6256</strong></p>
   <p>Endereço: Rua Exemplo, 123, Brasília - DF</p>
   <iframe 
     src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3976.000000!2d-47.900000!3d-15.780000!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2sBrasília%2C+DF!5e0!3m2!1spt-BR!2sbr" 
     allowfullscreen=""
     loading="lazy">
   </iframe>
 </div>

 <script>
 // ... (mantenha setDataMinima e inputData.addEventListener) ...

// Envio do formulário
form.addEventListener('submit', function(e) {
    e.preventDefault();
    mensagem.textContent = "";

    const nome = document.getElementById('nome').value.trim();
    const telefone = telefoneInput.value.trim();
    const servico = document.getElementById('servico').value;
    const alergia = document.getElementById('alergia').value.trim();
    const data = document.getElementById('data').value;

    // 1. Validação do telefone
    const telefoneRegex = /^\(\d{2}\)\s?\d{4,5}-\d{4}$/;
    if(!telefoneRegex.test(telefone)) {
        mensagem.textContent = "Telefone inválido. Use o formato (61) 9575-6256.";
        return;
    }

    // 2. Coleta de dados
    const formData = new FormData();
    formData.append('nome', nome);
    formData.append('telefone', telefone);
    formData.append('servico', servico);
    formData.append('alergia', alergia);
    formData.append('data_hora', data); // Usamos 'data_hora' no PHP

    // 3. Envia os dados para o PHP para SALVAR no banco
    fetch('salvar_e_enviar.php', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            // 4. Se salvou no banco, ABRE o WhatsApp
            window.open(data.whatsapp_url, '_blank');
            
            mensagem.style.color = "green";
            mensagem.textContent = `Obrigado, ${nome}! Agendamento salvo. Clique na aba do WhatsApp para enviar a confirmação.`;
            form.reset();
            setDataMinima();
        } else {
            // Erro retornado pelo PHP
            mensagem.textContent = "Erro ao salvar no banco de dados: " + data.message;
        }
    })
    .catch(error => {
        // Erro de comunicação com o servidor
        mensagem.textContent = "Erro de rede ou servidor. Tente novamente.";
        console.error('Fetch error:', error);
    });
});
 </script>

 </body>
 </html>
